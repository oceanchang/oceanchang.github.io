[{"title":"centos6.5系统gunicorn、supervisor、nginx部署flask","date":"2017-01-17T08:58:00.000Z","path":"centos6-5-gunicorn-supervisor-nginx-flask/","text":"_author:oceanbj create:2016-11-15 last update:_2016-11-20 flask 安装配置python版本2.7.9我的flask涉及到配置需要说明的文件目录如下 1234567891011121314151617myblog|+- app/| || +- __init__.py| || +- static/| || +- templates/| || +- views/| |+- run.py|+- deploy_config.py|+- config.py /usr/loca/nginx/ngix/usr/loca/nginx/ngix.conf /etc/supervisor/conf.d/myblog.conf/etc/supervisord.conf 为你的flask创建运行文件run.pyfrom app import appif __name__ == &#39;__main__&#39;: app.run(host=‘0.0.0.0’, debug = True) 简单的flask启动程序注意事项，一定要用if __name__ == &#39;__main__’:，否则在用gunicorn启动flask程序时会出现error: [Errno 98] Address already in use这个错误 安装GunicornGunicorn (独角兽)是一个高效的Python WSGI Server,通常用它来运行 wsgi application(由我们自己编写遵循WSGI application的编写规范) 或者 wsgi framework(如Django,Paster),地位相当于Java中的Tomcat。 可以采用easy_install 或下载源码安装git clone git://github.com/benoitc/gunicorn.git 但最好的方式是使用pip安装，因为可以卸载和管理 pip install gunicorn gunicorn 默认使用同步阻塞的网络模型(-k sync)，对于大并发的访问可能表现不够好， 它还支持其它更好的模式，比如：gevent或meinheld，需要安装如下插件 pip install greenlet pip install eventlet pip install gevent 运行 # gunicorn -k gevent -w 2 -b 127.0.0.1:3721 run:app 可以为gunicorn创建运行配置文件，deploy_config.py Gunicorn worker的数量从经验的角度一般配置 2 * core + 1, core指的核心数。 1 #-*- coding:utf-8 -*- 2 import os 3 bind=‘127.0.0.1:3721' #绑定的端口 4 workers=2 #worker数量 5 backlog=2048 6 worker_class=\"gevent\" #\"sync\" 7 debug=True 8 proc_name='gunicorn.pid' 9 pidfile='/var/log/gunicorn/debug.log' 10 loglevel='debug’ 运行:# gunicorn -c deploy_config.py run:app 此时你的flask程序已经能够正常运行了，下面的supervisor是一个守护程序 安装配置Supervisoryum可以直接安装Supervisor，需要注意的是Supervisor只支持Python2，所以不要在虚拟环境中使用pip安装supervisor。 yum install supervisor 安装后创建配置文件/etc/supervisor/conf.d/myblog.conf 1 [program:myblog] 2 command = /usr/bin/python /usr/bin/gunicorn -c /opt/www/myblog/deploy_config.py run:app 3 directory = /opt/www/myblog 4 autostart = true 5 autorestart = true 6 user = root 7 startsecs = 3 8 startretries = 20 9 redirect_stderr = true 10 stdout_logfile_maxbytes = 50MB 11 stdout_logfile_backups = 10 12 stdout_logfile = /opt/www/myblog/log/myblog.log 创建配置文件后修改/etc/supervisord.conf将刚才的配置文件包含进来 ; 包含其他的配置文件[include]files = /etc/supervisor/conf.d/*.conf ; 可以是 *.conf 或 *.ini 配置完成后启动生效 # supervisord -c /etc/supervisord.conf 基本用法 supervisord -c supervisor.conf 通过配置文件启动supervisor supervisorctl -c supervisor.conf status 察看supervisor的状态 supervisorctl -c supervisor.conf reload 重新载入 配置文件 supervisorctl -c supervisor.conf start [all]|[appname] 启动指定/所有 supervisor管理的程序进程 supervisorctl -c supervisor.conf stop [all]|[appname] 关闭指定/所有 supervisor管理的程序进程 上面由supervisor启动gunicorn安装配置完毕，下面配置nginx的反向代理 nginx 安装配置nginx安装可以自己找其他资料关于正向代理和反向代理的概念只是不同位置请求网络资源的不同说法，你用笔记本上网浏览网页通过的一个代理就叫正向代理，如果互联网过来的一个请求访问一个IDC机房的一个内网web服务，这个服务由nginx转进来就叫做反向代理，nginx 一般用于反向代理和负载均衡，这个IDC机房的web服务也可以直接用公网IP访问，但是为了解决高并发负载均衡的问题引入了nginx反向代理这个概念。 nginx配置文件 35server {36 listen 5001;37 server_name localhost;38 root /opt/www/myblog/app;39 access_log /opt/www/myblog/log/access_log;40 error_log /opt/www/myblog/log/error_log;4142 #charset koi8-r;4344 #access_log logs/host.access.log main;45 # 处理静态资源:46 location ~ ^\\/static\\/.*$ {47 root /opt/www/myblog/app;48 }495051 location / {52 #root html;53 #index index.html index.htm;54 #请求转向本机ip:372155 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;56 proxy_set_header X-Real-IP $remote_addr;57 proxy_set_header Host $host:5001;58 proxy_redirect off;59 proxy_pass http://127.0.0.1:3721; # 这里是gunicorn监听的地址60 }过程中，配置完配置文件重新启动nginx执行命令# /usr/local/nginx/nginx -c /usr/local/nginx/nginx.conf遇到错误如下：nginx: [emerg] bind() to 0.0.0.0:5001 failed (98: Address already in use)原因是nginx已经在运行了，执行killall nginx后再次执行如下命令就正常运行起来了# /usr/local/nginx/nginx -c /usr/local/nginx/nginx.conf https://oceanchang.github.io/centos6-5-gunicorn-supervisor-nginx-flask-2016-11-20-update/https://3600cn.com/centos6-5-gunicorn-supervisor-nginx-flask-2016-11-20-update/","tags":[{"name":"python","slug":"python","permalink":"https://oceanchang.github.io/tags/python/"},{"name":"flask","slug":"flask","permalink":"https://oceanchang.github.io/tags/flask/"}]},{"title":"Hello World","date":"2017-01-17T06:52:00.000Z","path":"hello-world/","text":"Welcome to ocean chang ‘s blog.Enjoy life, discover self and explore the world!ocean.chang@qq.com","tags":[]}]